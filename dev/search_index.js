var documenterSearchIndex = {"docs":
[{"location":"visualise/#Visualise","page":"Visualise","title":"Visualise","text":"","category":"section"},{"location":"visualise/","page":"Visualise","title":"Visualise","text":"visualise","category":"page"},{"location":"visualise/","page":"Visualise","title":"Visualise","text":"\n<script type=\"module\">\n\n  import * as THREE from 'https://cdn.skypack.dev/three';\n\nimport  { TrackballControls }  from 'https://cdn.skypack.dev/three-trackballcontrols';\n\n</script>\n\n\n<div id=\"webgl\"></div>\n\n\n<script>\n(function () {\n\nvar webglEl = document.getElementById('webgl');\n\nif (!Detector.webgl) {\n   Detector.addGetWebGLMessage(webglEl);\n   return;\n}\n\nvar width  = 600,\n   height = 600;\n\n// sphere params\nvar radius   = 1,\n   segments = 36,\n   rotation = 6;\n\nvar scene = new THREE.Scene();\nscene.background = new THREE.Color( 0xeeeeee );\n\n\nvar camera = new THREE.PerspectiveCamera(100, width / height, 0.01, 1000);\n\ncamera.position.z = 200;\n\nvar renderer = new THREE.WebGLRenderer();\nrenderer.setSize(width, height);\n\nconst frontSpot = new THREE.SpotLight(0xeeeece);\nfrontSpot.position.set(1000, 1000, 1000);\nscene.add(frontSpot);\n\nconst frontSpot2 = new THREE.SpotLight(0xddddce);\nfrontSpot2.position.set(-500, -500, -500);\nscene.add(frontSpot2);\n\n\nscene.add(new THREE.AmbientLight(0xffffff, 1));\n\n   var xDistance = 2;\n    var yDistance = 2;\n      //initial offset so does not start in middle.\n      var xOffset = 0;\n      var yOffset = 1;\n      var sphere1 = createSphere(radius, segments);\n                sphere1.position.x = 35.35533905932738;\n                sphere1.position.y = 35.35533905932737;\n                sphere1.position.z = 99.99999999999999;\n                sphere1.scale.set(10,10,20);\n                sphere1.rotation.z = 3.9269908169872414;\n                sphere1.rotation.x = 2.137707831735906;\n                sphere1.rotation.y = 0.0;\n                sphere1.rotation.order = 'ZXY';\n                scene.add(sphere1);\nvar sphere2 = createSphere(radius, segments);\n                sphere2.position.x = 3.061616997868383e-15;\n                sphere2.position.y = 50.0;\n                sphere2.position.z = 74.99999999999999;\n                sphere2.scale.set(10,10,20);\n                sphere2.rotation.z = 4.71238898038469;\n                sphere2.rotation.x = 2.137707831735906;\n                sphere2.rotation.y = 0.0;\n                sphere2.rotation.order = 'ZXY';\n                scene.add(sphere2);\nvar sphere3 = createSphere(radius, segments);\n                sphere3.position.x = -35.35533905932737;\n                sphere3.position.y = 35.35533905932738;\n                sphere3.position.z = 49.999999999999986;\n                sphere3.scale.set(10,10,20);\n                sphere3.rotation.z = -0.7853981633974483;\n                sphere3.rotation.x = 2.137707831735906;\n                sphere3.rotation.y = 0.0;\n                sphere3.rotation.order = 'ZXY';\n                scene.add(sphere3);\nvar sphere4 = createSphere(radius, segments);\n                sphere4.position.x = -50.0;\n                sphere4.position.y = 6.123233995736766e-15;\n                sphere4.position.z = 24.999999999999986;\n                sphere4.scale.set(10,10,20);\n                sphere4.rotation.z = -2.220446049250313e-16;\n                sphere4.rotation.x = 2.137707831735906;\n                sphere4.rotation.y = 0.0;\n                sphere4.rotation.order = 'ZXY';\n                scene.add(sphere4);\nvar sphere5 = createSphere(radius, segments);\n                sphere5.position.x = -35.355339059327385;\n                sphere5.position.y = -35.35533905932737;\n                sphere5.position.z = 0.0;\n                sphere5.scale.set(10,10,20);\n                sphere5.rotation.z = 0.7853981633974481;\n                sphere5.rotation.x = 2.137707831735906;\n                sphere5.rotation.y = 0.0;\n                sphere5.rotation.order = 'ZXY';\n                scene.add(sphere5);\nvar sphere6 = createSphere(radius, segments);\n                sphere6.position.x = -9.184850993605149e-15;\n                sphere6.position.y = -50.0;\n                sphere6.position.z = -25.000000000000014;\n                sphere6.scale.set(10,10,20);\n                sphere6.rotation.z = 1.5707963267948963;\n                sphere6.rotation.x = 2.137707831735906;\n                sphere6.rotation.y = 0.0;\n                sphere6.rotation.order = 'ZXY';\n                scene.add(sphere6);\nvar sphere7 = createSphere(radius, segments);\n                sphere7.position.x = 35.35533905932737;\n                sphere7.position.y = -35.355339059327385;\n                sphere7.position.z = -49.999999999999986;\n                sphere7.scale.set(10,10,20);\n                sphere7.rotation.z = 2.356194490192345;\n                sphere7.rotation.x = 2.137707831735906;\n                sphere7.rotation.y = 0.0;\n                sphere7.rotation.order = 'ZXY';\n                scene.add(sphere7);\nvar sphere8 = createSphere(radius, segments);\n                sphere8.position.x = 50.0;\n                sphere8.position.y = -1.2246467991473532e-14;\n                sphere8.position.z = -75.00000000000001;\n                sphere8.scale.set(10,10,20);\n                sphere8.rotation.z = 3.141592653589793;\n                sphere8.rotation.x = 2.137707831735906;\n                sphere8.rotation.y = 0.0;\n                sphere8.rotation.order = 'ZXY';\n                scene.add(sphere8);\nvar sphere9 = createSphere(radius, segments);\n                sphere9.position.x = 35.355339059327385;\n                sphere9.position.y = 35.35533905932737;\n                sphere9.position.z = -100.00000000000001;\n                sphere9.scale.set(10,10,20);\n                sphere9.rotation.z = 3.9269908169872414;\n                sphere9.rotation.x = 2.137707831735906;\n                sphere9.rotation.y = 0.0;\n                sphere9.rotation.order = 'ZXY';\n                scene.add(sphere9);\nvar sphere10 = createSphere(radius, segments);\n                sphere10.position.x = 1.5308084989341916e-14;\n                sphere10.position.y = 50.0;\n                sphere10.position.z = -124.99999999999999;\n                sphere10.scale.set(10,10,20);\n                sphere10.rotation.z = 4.71238898038469;\n                sphere10.rotation.x = 2.137707831735906;\n                sphere10.rotation.y = 0.0;\n                sphere10.rotation.order = 'ZXY';\n                scene.add(sphere10);\n\n\n\n//var axesHelper = new THREE.AxesHelper( 5 );\n//scene.add( axesHelper );\n\n         scene.add( new THREE.AxesHelper( 1 ) );\nvar controls = new THREE.TrackballControls(camera);\n\nwebglEl.appendChild(renderer.domElement);\n\nrender();\n\nfunction render() {\n   controls.update();\n   requestAnimationFrame(render);\n   renderer.render(scene, camera);\n}\n\n\n\nfunction createSphere(radius, segments) {\n// material = new THREE.MeshBasicMaterial( {color: 0xffff00} );\n//\t const material = new THREE.MeshLambertMaterial({\n//  color: 0xdaa520,\n//  emissive: 0x111111,\n//});\nconst material = new THREE.MeshStandardMaterial({\ncolor: 0xfcc742,\nemissive: 0x111111,\nspecular: 0xffffff,\nmetalness: 0.8,\nroughness: 0.6,\n});\n   return new THREE.Mesh(\n      new THREE.SphereGeometry(radius, segments, segments),\n      material\n   );\n}\n\n\n}());\n</script>","category":"page"},{"location":"materials/#Materials","page":"Materials","title":"Materials","text":"","category":"section"},{"location":"materials/","page":"Materials","title":"Materials","text":"Material","category":"page"},{"location":"materials/#CoupledDipole.Material","page":"Materials","title":"CoupledDipole.Material","text":"Material(wavelength, media)\n\nWavelength-dependent optical properties.\n\n\n\n\n\n","category":"type"},{"location":"materials/#Dielectric-functions","page":"Materials","title":"Dielectric functions","text":"","category":"section"},{"location":"materials/","page":"Materials","title":"Materials","text":"epsilon_Ag","category":"page"},{"location":"materials/#CoupledDipole.epsilon_Ag","page":"Materials","title":"CoupledDipole.epsilon_Ag","text":"epsilon_Ag(λ::Real)\n\nDrude model for the dielectric function of silver in the visible region\n\nλ: wavelength in nm\n\nExamples\n\njulia> round(epsilon_Ag(632.8), digits=5)\n-16.11377 + 0.74871im\n\n\n\n\n\n","category":"function"},{"location":"materials/","page":"Materials","title":"Materials","text":"epsilon_Au","category":"page"},{"location":"materials/#CoupledDipole.epsilon_Au","page":"Materials","title":"CoupledDipole.epsilon_Au","text":"epsilon_Au(λ::Real)\n\nExtended Drude model for the dielectric function of gold in the visible region\n\nλ: wavelength in nm\n\nExamples\n\njulia>  round(epsilon_Au(632.8), digits=5)\n-11.40185 + 1.18679im\n\n\n\n\n\n","category":"function"},{"location":"materials/#Particle-polarisabilities","page":"Materials","title":"Particle polarisabilities","text":"","category":"section"},{"location":"materials/","page":"Materials","title":"Materials","text":"alpha_kuwata","category":"page"},{"location":"materials/#CoupledDipole.alpha_kuwata","page":"Materials","title":"CoupledDipole.alpha_kuwata","text":"alpha_kuwata(λ, ε, ε_m, Size)\n\nPrincipal polarisability components of a spheroidal particle\n\nλ: wavelength\nε: complex dielectric function\nε_m: dielectric function of surrounding medium\nSize: SVector with 3 semi-axes of the spheroid\n\nExamples\n\njulia> alpha_kuwata(500, -10+1im, SVector(30, 30, 50), 1.33^2)\n3-element SVector{3, ComplexF64} with indices SOneTo(3):\n  77076.04648078184 + 26235.664281642235im\n  77076.04648078184 + 26235.664281642235im\n -98187.15974124733 + 205835.30299929058im\n\n\n\n\n\n","category":"function"},{"location":"materials/","page":"Materials","title":"Materials","text":"alpha_spheroids","category":"page"},{"location":"materials/#CoupledDipole.alpha_spheroids","page":"Materials","title":"CoupledDipole.alpha_spheroids","text":"alpha_spheroids(λ, ε, ε_m, Sizes)\n\nPrincipal polarisability components of N spheroidal particles\n\nλ: wavelength\nε: complex dielectric function\nε_m: dielectric function of surrounding medium\nSizes: Vector of 3-SVectors of particle sizes\n\nExamples\n\njulia> alpha_spheroids(500, -10+1im, 1.33^3, [SVector(30, 30, 50) for i in 1:4])\n4-element Vector{SVector{3, ComplexF64}}:\n [83399.81975161123 + 64172.28157743772im, 83399.81975161123 + 64172.28157743772im, -86034.64340475321 + 79773.72029581512im]\n [83399.81975161123 + 64172.28157743772im, 83399.81975161123 + 64172.28157743772im, -86034.64340475321 + 79773.72029581512im]\n [83399.81975161123 + 64172.28157743772im, 83399.81975161123 + 64172.28157743772im, -86034.64340475321 + 79773.72029581512im]\n [83399.81975161123 + 64172.28157743772im, 83399.81975161123 + 64172.28157743772im, -86034.64340475321 + 79773.72029581512im]\n\n\n\n\n\n","category":"function"},{"location":"materials/#Molecular-polarisabilities","page":"Materials","title":"Molecular polarisabilities","text":"","category":"section"},{"location":"materials/","page":"Materials","title":"Materials","text":"lorentzian","category":"page"},{"location":"materials/#CoupledDipole.lorentzian","page":"Materials","title":"CoupledDipole.lorentzian","text":"lorentzian(λ::Real, α_k::Real, λ_k::Real, µ_k::Real)\n\nComplex Lorentz function, to describe polarisabilities\n\nλ: wavelength in nm\nα_k: oscillator strength in S.I. units\nλ_k: oscillator wavelength in nm\nµ_k: damping in S.I. units\n\nExamples\n\njulia> round(lorentzian(632.8)*1e39, digits=5)\n6.58095 + 1.35961im\n\n\n\n\n\n","category":"function"},{"location":"materials/","page":"Materials","title":"Materials","text":"alpha_bare","category":"page"},{"location":"materials/#CoupledDipole.alpha_bare","page":"Materials","title":"CoupledDipole.alpha_bare","text":"alpha_bare(λ::T, α_∞::T, α_k::Array{T}, λ_k::Array{T}, µ_k::Array{T}) where T <: Real\n\nComplex scalar polarisability, as sum of lorentz oscillators\n\nλ: wavelength in nm\nα_k: oscillator strength(s) in S.I. units\nλ_k: oscillator wavelength(s) in nm\nµ_k: damping(s) in S.I. units\n\nDefault values mimic the main resonance of Rhodamine 700\n\nExamples\n\njulia> round(alpha_bare(632.8), digits=5)\n0.14543 + 0.01222im\n\n\n\n\n\n","category":"function"},{"location":"materials/","page":"Materials","title":"Materials","text":"alpha_embed","category":"page"},{"location":"materials/#CoupledDipole.alpha_embed","page":"Materials","title":"CoupledDipole.alpha_embed","text":"alpha_embed(α::Complex{T}, medium::T) where T <: Real\n\nEffective point polarisability in medium, rescaled by local field correction\n\nα: bare polarisabilty\nmedium: refractive index of embedding medium\n\nDefault values mimic the main resonance of Rhodamine 700\n\nExamples\n\njulia> round(alpha_embed(alpha_bare(632.8)), digits=5)\n0.12976 + 0.0109im\n\n\n\n\n\n","category":"function"},{"location":"materials/","page":"Materials","title":"Materials","text":"alpha_scale","category":"page"},{"location":"materials/#CoupledDipole.alpha_scale","page":"Materials","title":"CoupledDipole.alpha_scale","text":"alpha_scale(alpha, sizes::SVector{3})\n\nPrincipal polarisability components of a particle, rescaled along each principal axis\n\nα: scalar polarisabilty\nsizes: 3-vector to scale along each principal axis\n\n\n\n\n\n","category":"function"},{"location":"system/#System-of-equations","page":"System of equations","title":"System of equations","text":"","category":"section"},{"location":"system/","page":"System of equations","title":"System of equations","text":"propagator_freespace_labframe!","category":"page"},{"location":"system/#CoupledDipole.propagator_freespace_labframe!","page":"System of equations","title":"CoupledDipole.propagator_freespace_labframe!","text":"propagator_freespace_labframe!(A,\n    kn, R::Vector{SVector{3}},\n    AlphaBlocks::Vector{SMatrix{3,3}})\n\nInteraction matrix\n\nA: 3N_dip x 3N_dip interaction matrix\nkn: wavenumber in incident medium\nR: N_dip-vector of 3-Svectors of particle positions\nAlphaBlocks: N_dip-vector of 3x3 Smatrices (polarisability tensors in the lab frame)\n\n\n\n\n\n","category":"function"},{"location":"system/","page":"System of equations","title":"System of equations","text":"incident_field!","category":"page"},{"location":"system/#CoupledDipole.incident_field!","page":"System of equations","title":"CoupledDipole.incident_field!","text":"incident_field!(Ein,\n    Ejones,\n    kn, R::Vector{SVector{3}},\n    IncidenceRotations)\n\nIncident field at particle positions\n\nEin: 3N_dip x N_inc matrix, right-hand side of coupled-dipole system\nEjones: tuple of 2 2-Svectors defining 2 orthogonal Jones polarisations\nkn: wavenumber in incident medium\nR: N_dip-vector of 3-Svectors of particle positions\nIncidenceRotations: N_inc-vector of rotation 3-Smatrices\n\n\n\n\n\n","category":"function"},{"location":"system/","page":"System of equations","title":"System of equations","text":"polarisation!","category":"page"},{"location":"system/#CoupledDipole.polarisation!","page":"System of equations","title":"CoupledDipole.polarisation!","text":"polarisation!(P, E, AlphaBlocks)\n\nSelf-consistent dipole moments from the electric field, P = αE\n\nP: 3N_dip x N_inc matrix, polarisations for all incidences\nE: 3N_dip x N_inc matrix, total field for all incidences\nAlphaBlocks: N_dip-vector of 3x3 Smatrices (polarisability tensors in the lab frame)\n\n\n\n\n\n","category":"function"},{"location":"dyes/#Dimer-of-uniaxial-dye-molecules","page":"Dimer of uniaxial dye molecules","title":"Dimer of uniaxial dye molecules","text":"","category":"section"},{"location":"dyes/","page":"Dimer of uniaxial dye molecules","title":"Dimer of uniaxial dye molecules","text":"This example considers the coupling between two uniaxial dye molecules in close proximity, with a side-by-side configuration.","category":"page"},{"location":"dyes/","page":"Dimer of uniaxial dye molecules","title":"Dimer of uniaxial dye molecules","text":"using CoupledDipole\nusing StaticArrays\nusing DataFrames\nusing VegaLite\n\n## materials\nwavelength = collect(400:1:700.0)\nmedia = Dict([(\"Rhodamine\", alpha_bare), (\"medium\", x -> 1.33)])\nmat = Material(wavelength, media)\n\n## dimer geometry\ncl0 = cluster_single(0, 0, 1, 0, 0, 0, \"Rhodamine\", \"point\")\ncl1 = cluster_dimer(0.8, 0, 0, 1, 0, 0,0, \"Rhodamine\", \"point\")\n\n## incidence: along z, along x, along y\nIncidence = [SVector(0,0,0), SVector(0,π/2,0), SVector(π/2,π/2,0)]\n\ndisp1 = spectrum_dispersion(cl0, mat, Incidence)\ndisp2 = spectrum_dispersion(cl1, mat, Incidence)\n\nd1 = dispersion_df(disp1, mat.wavelengths)\nd2 = dispersion_df(disp2, mat.wavelengths)\n\nd = [insertcols!(d1, :cluster => \"dimer\");\n     insertcols!(d2, :cluster => \"single\")]\n\n @vlplot(data=d,\n width= 400,\n height =  300,\n     mark = {:line},\n     row = \"crosstype\",\n     resolve={scale={y=\"independent\"}},\n     encoding = {x = \"wavelength:q\", y = \"value:q\", color = \"variable:n\", strokeDash=\"cluster:n\"}\n )\n","category":"page"},{"location":"dyes/","page":"Dimer of uniaxial dye molecules","title":"Dimer of uniaxial dye molecules","text":"Note that there is essentially zero scattering since the molecules are much smaller than the wavelength.","category":"page"},{"location":"array/#Diffractive-array-of-gold-nanorods","page":"Diffractive array of gold nanorods","title":"Diffractive array of gold nanorods","text":"","category":"section"},{"location":"array/","page":"Diffractive array of gold nanorods","title":"Diffractive array of gold nanorods","text":"This example considers a square array of 200 Au nanorods with a large pitch (550nm); this configuration can lead to a diffractive coupling effect that strongly modifies the resonance of individual rods, despite their wide separation.","category":"page"},{"location":"array/","page":"Diffractive array of gold nanorods","title":"Diffractive array of gold nanorods","text":"using CoupledDipole\nusing StaticArrays\nusing DataFrames\nusing VegaLite\n\n## materials\nwavelengths = collect(400:2:1000.0)\nmedia = Dict([(\"Au\", epsilon_Au), (\"medium\", x -> 1.33)])\nmat = Material(wavelengths, media)\n\n## array geometry\n# N, Λ, a, b, c, φ, θ, ψ, material = \"Au\", type=\"particle\"\ncl0 = cluster_single(80, 40, 40)\ncl1 = cluster_array(200, 550, 80, 40, 40)\n","category":"page"},{"location":"array/","page":"Diffractive array of gold nanorods","title":"Diffractive array of gold nanorods","text":"We'll do the simulation at normal incidence, and simulate the properties of a single rod for reference,","category":"page"},{"location":"array/","page":"Diffractive array of gold nanorods","title":"Diffractive array of gold nanorods","text":"\n## incidence: along z\nIncidence = [SVector(0,0,0)]\n\ndisp1 = spectrum_dispersion(cl0, mat, Incidence)\ndisp2 = spectrum_dispersion(cl1, mat, Incidence)\n\nd1 = dispersion_df(disp1, mat.wavelengths)\nd2 = dispersion_df(disp2, mat.wavelengths)\n\nd = [insertcols!(d1, :cluster => \"single\");\n     insertcols!(d2, :cluster => \"array\")]\n\n @vlplot(data=d,\n width= 400,\n height =  300,\n     mark = {:line},\n     row = \"crosstype\",\n     resolve={scale={y=\"independent\"}},\n     encoding = {x = \"wavelength:q\", y = \"value:q\", color = \"variable:n\", strokeDash=\"cluster:n\"}\n )\n","category":"page"},{"location":"array/","page":"Diffractive array of gold nanorods","title":"Diffractive array of gold nanorods","text":"Note that scattering cross-sections are terribly inaccurate here; because of the large size of the cluster the numerical quadrature would require a large number of scattering angles. It would be preferable to evaluate scattering as the difference between extinction and absorption.","category":"page"},{"location":"utils/#Utility-functions","page":"Utility functions","title":"Utility functions","text":"","category":"section"},{"location":"utils/#Euler-rotations","page":"Utility functions","title":"Euler rotations","text":"","category":"section"},{"location":"utils/","page":"Utility functions","title":"Utility functions","text":"euler_active","category":"page"},{"location":"utils/#CoupledDipole.euler_active","page":"Utility functions","title":"CoupledDipole.euler_active","text":"euler_active(φ::Real, θ::Real, ψ::Real)\n\n3D rotation matrix\n\nφ: Euler angle (longitude, in [0,2π])\nθ: Euler angle (colatitude, in [0,2π])\nψ: Euler angle (rotation around z\", in [0,2π])\n\nExamples\n\njulia> round.(euler_active(π/2,0,0), digits=5)\n3×3 SMatrix{3, 3, Float64, 9} with indices SOneTo(3)×SOneTo(3):\n  0.0  -1.0  0.0\n  1.0   0.0  0.0\n -0.0   0.0  1.0\n\n\n\n\n\n","category":"function"},{"location":"utils/","page":"Utility functions","title":"Utility functions","text":"euler_passive","category":"page"},{"location":"utils/#CoupledDipole.euler_passive","page":"Utility functions","title":"CoupledDipole.euler_passive","text":"euler_passive(φ::Real, θ::Real, ψ::Real)\n\n3D rotation matrix\n\nφ: Euler angle (longitude, in [0,2π])\nθ: Euler angle (colatitude, in [0,2π])\nψ: Euler angle (rotation around z\", in [0,2π])\n\nExamples\n\njulia> round.(euler_passive(π/2,0,0), digits=5)\n3×3 SMatrix{3, 3, Float64, 9} with indices SOneTo(3)×SOneTo(3):\n  0.0  1.0  -0.0\n -1.0  0.0   0.0\n  0.0  0.0   1.0\n\n\n\n\n\n","category":"function"},{"location":"utils/","page":"Utility functions","title":"Utility functions","text":"axis_angle","category":"page"},{"location":"utils/#CoupledDipole.axis_angle","page":"Utility functions","title":"CoupledDipole.axis_angle","text":"axis_angle(v = SVector(0, 1, 0), θ)\n\n3D rotation matrix from axis-angle representation\n\nv: SVector\nθ: rotation angle\n\nExamples\n\njulia> axis_angle(SVector(0, 1, 0), π/4)\n3×3 SMatrix{3, 3, Float64, 9} with indices SOneTo(3)×SOneTo(3):\n  0.707107  0.0  0.707107\n  0.0       1.0  0.0\n -0.707107  0.0  0.707107\n\n\n\n\n\n","category":"function"},{"location":"utils/","page":"Utility functions","title":"Utility functions","text":"euler_unitvector","category":"page"},{"location":"utils/#CoupledDipole.euler_unitvector","page":"Utility functions","title":"CoupledDipole.euler_unitvector","text":"euler_unitvector(φ::Real, θ::Real)\n\nUnit vector along direction φ, θ\n\nφ: Euler angle (longitude, in [0,2π])\nθ: Euler angle (colatitude, in [0,2π])\n\nExamples\n\njulia> euler_unitvector(π/2, 0)\n3-element SVector{3, Float64} with indices SOneTo(3):\n 0.0\n 0.0\n 1.0\n\n\n\n\n\n","category":"function"},{"location":"utils/#Spherical-cubature","page":"Utility functions","title":"Spherical cubature","text":"","category":"section"},{"location":"utils/","page":"Utility functions","title":"Utility functions","text":"quadrature_lgwt","category":"page"},{"location":"utils/#CoupledDipole.quadrature_lgwt","page":"Utility functions","title":"CoupledDipole.quadrature_lgwt","text":"quadrature_lgwt(N::Int, a::Real, b::Real)\n\nN-point Gauss-Legendre quadrature over [a,b] interval\n\nN: number of nodes\na,b: bounds\n\nint_a^b f(x)dx=fracb-a2int_-1^1fleft(fracb-a2 x + fraca+b2right)dx\n\nExamples\n\njulia> quadrature_lgwt(6,0,3)\n(nodes = [0.10129572869527204, 0.5081859203006033, 1.1420712208752046, 1.8579287791247954, 2.4918140796993966, 2.898704271304728], weights = [0.25698673856875537, 0.5411423595722078, 0.7018709018590369, 0.7018709018590369, 0.5411423595722078, 0.25698673856875537])\n\n\n\n\n\n","category":"function"},{"location":"utils/","page":"Utility functions","title":"Utility functions","text":"cubature_sphere","category":"page"},{"location":"utils/#CoupledDipole.cubature_sphere","page":"Utility functions","title":"CoupledDipole.cubature_sphere","text":"cubature_sphere(N::Int, method::String)\n\nN-point cubature on the sphere\n\nN: number of nodes\nmethod: cubature method (only 'gl' currently implemented)\n\nReturns a Cubature object containing 2 arrays (N'x3 nodes and N'x1 weights), N'≈N Note: using array instead of tuple for weights because we'll use them in a scalar product in orientation-averaging For nodes there is less of a reason, but it can be convenient to visualise the nodes.\n\nThe cubature is normalised by 4π such that a unit integrand approximates 1.\n\nExamples\n\njulia> cubature_sphere(6)\n(nodes = SVector{3, Float64}[[0.43625314334650644, 2.1862760354652844, 0.0], [0.43625314334650644, 0.9553166181245093, 0.0], [2.0735107047038173, 2.1862760354652844, 0.0], [2.0735107047038173, 0.9553166181245093, 0.0], [4.2096746024757685, 2.1862760354652844, 0.0], [4.2096746024757685, 0.9553166181245093, 0.0], [5.846932163833079, 2.1862760354652844, 0.0], [5.846932163833079, 0.9553166181245093, 0.0]], weights = [0.08696371128436346, 0.08696371128436346, 0.16303628871563655, 0.16303628871563655, 0.16303628871563655, 0.16303628871563655, 0.08696371128436346, 0.08696371128436346])\n\n\n\n\n\n","category":"function"},{"location":"gettingstarted/#Getting-Started","page":"Getting Started","title":"Getting Started","text":"","category":"section"},{"location":"gettingstarted/#Installation","page":"Getting Started","title":"Installation","text":"","category":"section"},{"location":"gettingstarted/","page":"Getting Started","title":"Getting Started","text":"Pkg.add(\"CoupledDipole\")","category":"page"},{"location":"gettingstarted/#Example","page":"Getting Started","title":"Example","text":"","category":"section"},{"location":"gettingstarted/","page":"Getting Started","title":"Getting Started","text":"A typical simulation requires two inputs: a Cluster, describing the configuration of particles, and a Material, describing the wavelength-dependent dielectric functions of all media.","category":"page"},{"location":"gettingstarted/","page":"Getting Started","title":"Getting Started","text":"using CoupledDipole\nusing DataFrames\nusing VegaLite\n\n## cluster geometry\ncl1 = cluster_helix(8, 20, 20, 50, 200, 300, π/2, 0)\ncl0 = cluster_single(20, 20, 50) # reference: single-particle\n\n## materials\nwavelengths = collect(400:2:800.0)\nmedia = Dict([(\"Au\", epsilon_Au), (\"medium\", x -> 1.33)])\nmat = Material(wavelengths, media)\n","category":"page"},{"location":"gettingstarted/","page":"Getting Started","title":"Getting Started","text":"From these two objects we can simply call a high-level function to simulate optical properties. The following lines simulate the orientation-averaged optical response,","category":"page"},{"location":"gettingstarted/","page":"Getting Started","title":"Getting Started","text":"oa0 = spectrum_oa(cl0, mat) # reference: just one particle\noa1 = spectrum_oa(cl1, mat)","category":"page"},{"location":"gettingstarted/","page":"Getting Started","title":"Getting Started","text":"From there we combine the cross-sections in long-format dataframes for plotting,","category":"page"},{"location":"gettingstarted/","page":"Getting Started","title":"Getting Started","text":"d0 = oa_df(oa0, mat.wavelengths)\nd1 = oa_df(oa1, mat.wavelengths)\n\nd2 = [insertcols!(d1, :cluster => \"helix\");\n      insertcols!(d0, :cluster => \"single\")]\n\nd2 |> @vlplot(\n width= 200,\n height =  150,\n     mark = {:line, clip = true},\n     row = \"type\", column=\"variable\",\n     resolve={scale={y=\"independent\"}},\n     encoding = {x = \"wavelength:q\", y = \"value:q\",\n      strokeDash = \"cluster:n\", color = \"cluster:n\"}\n )\n","category":"page"},{"location":"conventions/#Conventions","page":"Conventions","title":"Conventions","text":"","category":"section"},{"location":"conventions/#Code-design-and-conventions","page":"Conventions","title":"Code design and conventions","text":"","category":"section"},{"location":"conventions/","page":"Conventions","title":"Conventions","text":"From a user's perspective the code provides 2 high-level functions to perform calculations of:","category":"page"},{"location":"conventions/","page":"Conventions","title":"Conventions","text":"Fixed orientation far-field cross-sections (extinction, absorption and scattering), for multiple wavelengths and incidence directions\nOrientation-averaged cross-sections (extinction, absorption and scattering) and associated circular dichroism spectra, using numerical cubature over the full solid angle","category":"page"},{"location":"conventions/","page":"Conventions","title":"Conventions","text":"The high-level functions require at least 2 inputs: ","category":"page"},{"location":"conventions/","page":"Conventions","title":"Conventions","text":"A Cluster object, describing the geometry of the particle cluster\nA Material object, describing the wavelength-dependent optical properties of the various media","category":"page"},{"location":"conventions/#Geometry-description","page":"Conventions","title":"Geometry description","text":"","category":"section"},{"location":"conventions/","page":"Conventions","title":"Conventions","text":"Cluster is a structure comprising 4 fields,","category":"page"},{"location":"conventions/","page":"Conventions","title":"Conventions","text":"positions, a vector of N particle positions stored as 3-vectors storing cartesian coordinates x,y,z\norientations, a vector of N particle orientations stored as quaternions (4 components, cosphi2 sinphi2 mathbfv with mathbfv the rotation axis). The quaternions are automatically converted into rotation matrices with the Rotations.jl package.\nmaterial, a string referencing the material for each particle; the corresponding dielectric functions are stored as a dictionary in the Material object\ntype, a string indicating whether the polarisability corresponds to a point dipole, or to a particle. For the former, a local-field correction needs to be applied to convert the polarisability into an effective one responding to macroscopic fields.","category":"page"},{"location":"conventions/#Material-description","page":"Conventions","title":"Material description","text":"","category":"section"},{"location":"conventions/","page":"Conventions","title":"Conventions","text":"The Material structure contains two fields:","category":"page"},{"location":"conventions/","page":"Conventions","title":"Conventions","text":"wavelengths, array-like wavelengths to use in the calculations\nmedia, a dictionary containing:\nthe different dielectric functions, such as \"Au\" => epsAu\nthe refractive index of the embedding medium, stored under the name \"medium\" => (x -> 1.33)\nfor point dipoles, a wavelength-dependent polarisability function \"alpha\" => alpha_dye","category":"page"},{"location":"conventions/#High-level-functions","page":"Conventions","title":"High level functions","text":"","category":"section"},{"location":"conventions/#Fixed-orientation-cross-sections","page":"Conventions","title":"Fixed orientation cross-sections","text":"","category":"section"},{"location":"conventions/#Angular-averaging-and-circular-dichroism","page":"Conventions","title":"Angular averaging and circular dichroism","text":"","category":"section"},{"location":"conventions/#Rotations","page":"Conventions","title":"Rotations","text":"","category":"section"},{"location":"conventions/#Angular-averaging","page":"Conventions","title":"Angular averaging","text":"","category":"section"},{"location":"conventions/","page":"Conventions","title":"Conventions","text":"\n<div id=\"webgl\"></div>\n\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js\"></script>\n<script src=\"https://unpkg.com/three@0.85.0/examples/js/controls/TrackballControls.js\"></script>\n<script src=\"https://unpkg.com/three@0.85.0/examples/js/Detector.js\"></script>\n\n<script>\ndefine('three', ['../assets/three.js'], function ( THREE ) {\n  window.THREE = THREE;\n  return THREE;\n});\n\n(function () {\n\nvar webglEl = document.getElementById('webgl');\n\nif (!Detector.webgl) {\n   Detector.addGetWebGLMessage(webglEl);\n   return;\n}\n\nvar width  = 600,\n   height = 600;\n\n// sphere params\nvar radius   = 1,\n   segments = 36,\n   rotation = 6;\n\nvar scene = new THREE.Scene();\nscene.background = new THREE.Color( 0xeeeeee );\n\n\nvar camera = new THREE.PerspectiveCamera(100, width / height, 0.01, 1000);\n\ncamera.position.z = 200;\n\nvar renderer = new THREE.WebGLRenderer();\nrenderer.setSize(width, height);\n\nconst frontSpot = new THREE.SpotLight(0xeeeece);\nfrontSpot.position.set(1000, 1000, 1000);\nscene.add(frontSpot);\n\nconst frontSpot2 = new THREE.SpotLight(0xddddce);\nfrontSpot2.position.set(-500, -500, -500);\nscene.add(frontSpot2);\n\n\nscene.add(new THREE.AmbientLight(0xffffff, 1));\n\n   var xDistance = 2;\n    var yDistance = 2;\n      //initial offset so does not start in middle.\n      var xOffset = 0;\n      var yOffset = 1;\n      var sphere1 = createSphere(radius, segments);\n                sphere1.position.x = 35.35533905932738;\n                sphere1.position.y = 35.35533905932737;\n                sphere1.position.z = 99.99999999999999;\n                sphere1.scale.set(10,10,20);\n                sphere1.rotation.z = 3.9269908169872414;\n                sphere1.rotation.x = 2.137707831735906;\n                sphere1.rotation.y = 0.0;\n                sphere1.rotation.order = 'ZXY';\n                scene.add(sphere1);\nvar sphere2 = createSphere(radius, segments);\n                sphere2.position.x = 3.061616997868383e-15;\n                sphere2.position.y = 50.0;\n                sphere2.position.z = 74.99999999999999;\n                sphere2.scale.set(10,10,20);\n                sphere2.rotation.z = 4.71238898038469;\n                sphere2.rotation.x = 2.137707831735906;\n                sphere2.rotation.y = 0.0;\n                sphere2.rotation.order = 'ZXY';\n                scene.add(sphere2);\nvar sphere3 = createSphere(radius, segments);\n                sphere3.position.x = -35.35533905932737;\n                sphere3.position.y = 35.35533905932738;\n                sphere3.position.z = 49.999999999999986;\n                sphere3.scale.set(10,10,20);\n                sphere3.rotation.z = -0.7853981633974483;\n                sphere3.rotation.x = 2.137707831735906;\n                sphere3.rotation.y = 0.0;\n                sphere3.rotation.order = 'ZXY';\n                scene.add(sphere3);\nvar sphere4 = createSphere(radius, segments);\n                sphere4.position.x = -50.0;\n                sphere4.position.y = 6.123233995736766e-15;\n                sphere4.position.z = 24.999999999999986;\n                sphere4.scale.set(10,10,20);\n                sphere4.rotation.z = -2.220446049250313e-16;\n                sphere4.rotation.x = 2.137707831735906;\n                sphere4.rotation.y = 0.0;\n                sphere4.rotation.order = 'ZXY';\n                scene.add(sphere4);\nvar sphere5 = createSphere(radius, segments);\n                sphere5.position.x = -35.355339059327385;\n                sphere5.position.y = -35.35533905932737;\n                sphere5.position.z = 0.0;\n                sphere5.scale.set(10,10,20);\n                sphere5.rotation.z = 0.7853981633974481;\n                sphere5.rotation.x = 2.137707831735906;\n                sphere5.rotation.y = 0.0;\n                sphere5.rotation.order = 'ZXY';\n                scene.add(sphere5);\nvar sphere6 = createSphere(radius, segments);\n                sphere6.position.x = -9.184850993605149e-15;\n                sphere6.position.y = -50.0;\n                sphere6.position.z = -25.000000000000014;\n                sphere6.scale.set(10,10,20);\n                sphere6.rotation.z = 1.5707963267948963;\n                sphere6.rotation.x = 2.137707831735906;\n                sphere6.rotation.y = 0.0;\n                sphere6.rotation.order = 'ZXY';\n                scene.add(sphere6);\nvar sphere7 = createSphere(radius, segments);\n                sphere7.position.x = 35.35533905932737;\n                sphere7.position.y = -35.355339059327385;\n                sphere7.position.z = -49.999999999999986;\n                sphere7.scale.set(10,10,20);\n                sphere7.rotation.z = 2.356194490192345;\n                sphere7.rotation.x = 2.137707831735906;\n                sphere7.rotation.y = 0.0;\n                sphere7.rotation.order = 'ZXY';\n                scene.add(sphere7);\nvar sphere8 = createSphere(radius, segments);\n                sphere8.position.x = 50.0;\n                sphere8.position.y = -1.2246467991473532e-14;\n                sphere8.position.z = -75.00000000000001;\n                sphere8.scale.set(10,10,20);\n                sphere8.rotation.z = 3.141592653589793;\n                sphere8.rotation.x = 2.137707831735906;\n                sphere8.rotation.y = 0.0;\n                sphere8.rotation.order = 'ZXY';\n                scene.add(sphere8);\nvar sphere9 = createSphere(radius, segments);\n                sphere9.position.x = 35.355339059327385;\n                sphere9.position.y = 35.35533905932737;\n                sphere9.position.z = -100.00000000000001;\n                sphere9.scale.set(10,10,20);\n                sphere9.rotation.z = 3.9269908169872414;\n                sphere9.rotation.x = 2.137707831735906;\n                sphere9.rotation.y = 0.0;\n                sphere9.rotation.order = 'ZXY';\n                scene.add(sphere9);\nvar sphere10 = createSphere(radius, segments);\n                sphere10.position.x = 1.5308084989341916e-14;\n                sphere10.position.y = 50.0;\n                sphere10.position.z = -124.99999999999999;\n                sphere10.scale.set(10,10,20);\n                sphere10.rotation.z = 4.71238898038469;\n                sphere10.rotation.x = 2.137707831735906;\n                sphere10.rotation.y = 0.0;\n                sphere10.rotation.order = 'ZXY';\n                scene.add(sphere10);\n\n\n\n//var axesHelper = new THREE.AxesHelper( 5 );\n//scene.add( axesHelper );\n\n         scene.add( new THREE.AxesHelper( 1 ) );\nvar controls = new THREE.TrackballControls(camera);\n\nwebglEl.appendChild(renderer.domElement);\n\nrender();\n\nfunction render() {\n   controls.update();\n   requestAnimationFrame(render);\n   renderer.render(scene, camera);\n}\n\n\n\nfunction createSphere(radius, segments) {\n// material = new THREE.MeshBasicMaterial( {color: 0xffff00} );\n//\t const material = new THREE.MeshLambertMaterial({\n//  color: 0xdaa520,\n//  emissive: 0x111111,\n//});\nconst material = new THREE.MeshStandardMaterial({\ncolor: 0xfcc742,\nemissive: 0x111111,\nspecular: 0xffffff,\nmetalness: 0.8,\nroughness: 0.6,\n});\n   return new THREE.Mesh(\n      new THREE.SphereGeometry(radius, segments, segments),\n      material\n   );\n}\n\n\n}());\n</script>","category":"page"},{"location":"dimer/#Chiral-dimer-of-gold-nanorods","page":"Chiral dimer of gold nanorods","title":"Chiral dimer of gold nanorods","text":"","category":"section"},{"location":"dimer/","page":"Chiral dimer of gold nanorods","title":"Chiral dimer of gold nanorods","text":"This example considers the \"fingers-crossed\" configuration of two gold nanorods arranged in a chiral dimer, with a pi/4 dihedral angle. The dipole-dipole interaction leads to circular dichroism with a characteristic bisignate lineshape.","category":"page"},{"location":"dimer/","page":"Chiral dimer of gold nanorods","title":"Chiral dimer of gold nanorods","text":"using CoupledDipole\nusing DataFrames\nusing VegaLite\n\n\n## materials\nwavelength = collect(450:2:850.0)\nmedia = Dict([(\"Au\", epsilon_Au), (\"medium\", x -> 1.33)])\nmat = Material(wavelength, media)\n\n## dimer geometry\ncl0 = cluster_single(20, 20, 40)\ncl1 = cluster_dimer(80, 20, 20, 40, π/4)\n","category":"page"},{"location":"dimer/","page":"Chiral dimer of gold nanorods","title":"Chiral dimer of gold nanorods","text":"The following lines simulate the orientation-averaged optical response,","category":"page"},{"location":"dimer/","page":"Chiral dimer of gold nanorods","title":"Chiral dimer of gold nanorods","text":"oa0 = spectrum_oa(cl0, mat)\noa1 = spectrum_oa(cl1, mat)\n","category":"page"},{"location":"dimer/","page":"Chiral dimer of gold nanorods","title":"Chiral dimer of gold nanorods","text":"From there we combine the cross-sections in long-format dataframes for plotting,","category":"page"},{"location":"dimer/","page":"Chiral dimer of gold nanorods","title":"Chiral dimer of gold nanorods","text":"\nd0 = oa_df(oa0, mat.wavelengths)\nd1 = oa_df(oa1, mat.wavelengths)\n\nd = [insertcols!(d1, :cluster => \"dimer\");\n     insertcols!(d0, :cluster => \"single\")]\n\nd5 |> @vlplot(\n width= 400,\n height =  300,\n     mark = {:line},\n     row = \"type\",\n     resolve={scale={y=\"independent\"}},\n     encoding = {x = \"wavelength:q\", y = \"value:q\", color = \"variable:n\", strokeDash=\"cluster:n\"}\n )\n","category":"page"},{"location":"theory/#Coupled-dipole-theory","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"","category":"section"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"From a microscopic viewpoint, as taken in the discrete dipole approximation, a collection of small inclusions such as molecules dispersed in a solvent may be described as a set of point dipoles in a vacuum, whereby not only the molecules of interest but also those comprising the medium itself are described as discrete dipoles. This approach is numerically prohibitive, due to the large number of dipoles required to model the environment, which is in fact infinite in most situations of interest.","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"With a more pragmatic approach, we consider the response of dipoles within the framework of the macroscopic Maxwell equations, where the optical response of the solvent is encompassed in its refractive index n=sqrtvarepsilon. Waves propagating in this medium have a phase velocity cn. Light scattering by a collection of particles (or molecules) is then described as the interaction between dipole moments induced by the incident light and in mutual interaction via their own scattered field in the surrounding homogeneous medium.","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"We define the dipole moments mathbfP to be proportional to the local (macroscopic) electric field,","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"mathbfP = mathbbalpha mathbfE","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"where mathbbalpha is a 3times 3 polarisability tensor, which will be discussed in section. The standard CD equations take the form,","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"mathbfP^i= mathbbalpha_i left( mathbfE_textinc + sum_jneq i mathbbG_ij mathbfP^jright)","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"yielding a linear system of 3N equations to be solved for the unknown polarisation vector mathbfP.","category":"page"},{"location":"theory/#Green's-tensor-in-a-medium","page":"Coupled dipole theory","title":"Green's tensor in a medium","text":"","category":"section"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"We derive in the Appendix the macroscopic field associated with a dipole in a medium,","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"mathbfE(mathbfr) =kappa^-1 fracmathrmexp(ikr)rleftk_1^2leftmathbfP - (mathbfhat rcdotmathbfP)mathbfhat r right + left(frac1r^2 - fracik_1rright) left3mathbfhat r(mathbfhat rcdotmathbfP) - mathbfPright rightqquad kappa = 4pivarepsilon_0varepsilon","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"which we may write as","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"mathbfE = mathbbG mathbfP","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"with,","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"mathbbG = kappa^-1 fracmathrmexp(ikr)rleftk_1^2leftmathbbI - mathbfhat rotimesmathbfhat r right - left(frac1r^2 - fracik_1rright) leftmathbbI - 3mathbfhat rotimesmathbfhat rright right","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"Note the constant prefactor kappa which will also appear in the definition of the polarisability, allowing us to disregard it throughout the code implementation, as discussed in section.","category":"page"},{"location":"theory/#Coupled-dipole-equations","page":"Coupled dipole theory","title":"Coupled dipole equations","text":"","category":"section"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"Since our code aims to model not only particles but also molecules, which can have a non-invertible tensor (for example a uniaxial response), this formulation is not suitable: solving for the polarisation mathbfP, one needs to form a matrix with block diagonal elements mathbbalpha^-1, where two of the principal components would become infinite. Instead, we recast the coupled dipole equations in a different form, solving for the self-consistent macroscopic fields at the dipole positions. This field mathbfE^i is the sum of the incident field and the field scattered by all other dipoles,","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"mathbfE^i=mathbfE_textinc(mathbfr_i) + sum_jneq i mathbbG_ij mathbbalpha_j mathbfE^j","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"where mathbbG_ij = mathbbG(mathbfr_imathbfr_j) is the Green's tensor for the field created by dipole i at the location of dipole j in the infinite surrounding medium,","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"mathbbG_ij = kappa^-1fracmathrmexp(ikr)_ijr_ijleftk_1^2leftmathbbI - mathbfhat r_ijotimesmathbfhat r_ij right - left(frac1r_ij^2 - fracik_1r_ijright) leftmathbbI - 3mathbfhat r_ijotimesmathbfhat r_ijright right","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"Note that optical reciprocity imposes the symmetry mathbbG_ji = mathbbG^intercal_ij. Grouping the fields mathbfE^i and mathbfE_textinc(mathbfr_i) into vectors mathbfE and mathbfE_textinc of length 3N, where N is the number of dipoles, the coupled system takes the matrix form,","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"mathbbF mathbfE  = mathbfE_textinc","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"defining the free-space interaction matrix mathbb F  = (mathbb I - mathbb Gmathbbalpha ).  The 3times 3 diagonal blocks of mathbbF are identity matrices, and each off-diagonal block is of the form mathbb F_ij = -mathbb G_ijmathbbalpha_j. Note that the product mathbb Gmathbbalpha implies that mathbb F is not longer (block-)symmetric, for an arbitrary set of polarisabilies (either unlike particles, or simply rotated along arbitrary orientations). For a three-dipoles system, the matrix representation can be written,","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"left\nbeginpmatrix\nmathbbImathbbOmathbbO\nmathbbOmathbbImathbbO\nmathbbOmathbbOmathbbI\nendpmatrix -\nbeginpmatrix\nmathbbOmathbbG_12mathbbalpha_2mathbbG_13mathbbalpha_3\nmathbbG_21mathbbalpha_1mathbbOmathbbG_23mathbbalpha_3\nmathbbG_31mathbbalpha_1mathbbG_32mathbbalpha_2mathbbO\nendpmatrix\nright\nbeginpmatrix\nmathbfE^1\nmathbfE^2\nmathbfE^3\nendpmatrix =\nbeginpmatrix\nmathbfE_textinc^1\nmathbfE_textinc^2\nmathbfE_textinc^3\nendpmatrix ","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"The linear system is solved by standard linear algebra routines (LU factorisation), yielding the self-consistent macroscopic electric field mathbfE at each dipole location. From these local fields we can calculate the polarisation mathbfP = mathbbalpha mathbfE.","category":"page"},{"location":"theory/#Order-of-scattering-solution","page":"Coupled dipole theory","title":"Order-of-scattering solution","text":"","category":"section"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"An alternative approach to solving the system of coupled dipole equations is to follow an order-of-scattering approximation scheme. The linear system of equations is formally re-written as","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"beginaligned\nmathbbF mathbfE = mathbfE_textinc\n mathbfE = (mathbbI - mathbbGmathbbalpha)^-1 mathbfE_textinc\n mathbfE = (mathbbI + mathbbGmathbbalpha + (mathbbGmathbbalpha)^2 + (mathbbalphamathbbG)^3 +dots) mathbfE_textinc\n mathbfE = underbracemathbfE_textinc_mathbfE^0 + underbracemathbbGmathbbalphamathbfE^0_mathbfE^1 + underbracemathbbGmathbbalphamathbfE^1_mathbfE^2 + underbracemathbbGmathbbalphamathbfE^2_mathbfE^3 +dots\nendaligned","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"The system (mathbbI - mathbbalphamathbbG) mathbfE = mathbfE_textinc is thus solved iteratively by defining a temporary variable mathbfE^n and taking the following steps,","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"beginaligned\nmathbfE^0 = mathbfE_textinc  mathbfE = mathbfE^0\nmathbfE^1 = mathbbGmathbbalphamathbfE^0   mathbfE = mathbfE^0 + mathbfE^1\nmathbfE^2 = mathbbGmathbbalphamathbfE^1          mathbfE = mathbfE^0 + mathbfE^1 + mathbfE^2\ndots \nendaligned","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"At each step we update the net field by adding a component corresponding to an higher order of multiple scattering. The procedure is followed iteratively until convergence of mathbfE is achieved with sufficient accuracy. Typically, the convergence criterion may be chosen as the relative change in the value of a far-field cross-section from one iteration to the next.","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"If the interaction between dipoles mathbbGmathbbalpha is no stronger than the contribution due to the incident field alone (mathbbI), convergence may be obtained and after a few iterations the polarisation and electric fields have reached their self-consistent value.","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"This procedure can be useful for relatively large systems of dipoles, provided they do not interact too strongly.","category":"page"},{"location":"theory/#Cross-sections","page":"Coupled dipole theory","title":"Cross-sections","text":"","category":"section"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"Physically-relevant quantities accessible to experiments that may be derived from the solution of the CD equations include the far-field cross-sections for scattering, absorption, and extinction.","category":"page"},{"location":"theory/#Scattering","page":"Coupled dipole theory","title":"Scattering","text":"","category":"section"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"The scattering cross-section can be computed by integrating the flux of the Poynting vector over all scattering directions in the far-field. For a single dipole, the result is,","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"sigma_textsca = frack_1^4 6pivarepsilon alpha^2","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"And for a collection of dipoles,","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"sigma_textsca = kappa^-2 k_1^4 iint_Omega leftsum_i left(mathbbI - mathbfhat notimesmathbfhat nright) mathbfP_i mathrmexp(-ik_1 mathbfr_icdotmathbfhat n)right^2 textdOmega","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"As an alternative, the scattering cross-section may be obtained from the difference between extinction and absorption cross-sections.","category":"page"},{"location":"theory/#Extinction","page":"Coupled dipole theory","title":"Extinction","text":"","category":"section"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"The extinction cross-section may be obtained from the optical theorem as the interference between incident and scattered fields,","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"sigma_textext = 4pikappa^-1 k_1 Imleft(mathbfP cdot mathbfE_textinc^* right)","category":"page"},{"location":"theory/#Absorption","page":"Coupled dipole theory","title":"Absorption","text":"","category":"section"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"The absorption cross-section is obtained by evaluating the work done by the total field, (but excluding self-reaction), on the dipoles:","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"sigma_textabs =  4pi kappa^-1 k_1 leftImleft(mathbfP cdot mathbfE^* right) - frac 2 3 kappa^-1 k_1^3 mathbfP^2right","category":"page"},{"location":"theory/#Polarisability-prescriptions","page":"Coupled dipole theory","title":"Polarisability prescriptions","text":"","category":"section"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"We defined the polarisability by the following relation between dipole moment and electric field,","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"mathbfP=mathbbalphamathbfE","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"noting that different authors include various prefactors such as 4pi, varepsilon, varepsilon_0 or combinations thereof. Polarisability prescriptions that are compatible with our chosen conventions are reviewed in this section. First, we consider the case of a subwavelength nanoparticle, with the standard static polarisability of a small sphere (\"Clausius-Mossotti\" polarisability), and a long-wavelength approximation for elongated particles that includes corrections for radiative damping and dynamic depolarisation.","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"We also discuss the polarisability of dye molecules, and its link to a microscopic (intrinsic) polarisability that may be obtained from first principle calculations.","category":"page"},{"location":"theory/#Effective-scaling-prefactor","page":"Coupled dipole theory","title":"Effective scaling prefactor","text":"","category":"section"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"The prefactor kappa appears in several equations and simplifies in the final expression for the cross-sections. We can therefore simplify the formalism throughout by defining reduced variables baralpha bar mathbfP barmathbbG. The correspondence is summarised in Table. Only the scaled quantities are used in the code, but for simplicity we refer to them with conventional variable names.","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"Equivalence between theory and rescaled equations used in the code. The prefactor kappa=4pivarepsilon_0varepsilon can be simplified throughout by defining a suitably scaled polarisability.","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":" Theory (with kappa = 4pivarepsilon_0varepsilon) Equivalent formulation used in the code\npolarisability alpha baralpha = kappa^-1alpha\nsphere (CM) alpha_textcm = kappa a^3fracvarepsilon - varepsilonvarepsilon +2 varepsilon baralpha_textcm = a^3fracvarepsilon - varepsilonvarepsilon +2 varepsilon\ndipole moment mathbfP = alphamathbfE barmathbfP = kappa^-1mathbfP\nGreen's function mathbbG= kappa^-1 fracmathrmexp(ikr)rleftdotsright barmathbbG = kappamathbbG = fracmathrmexp(ikr)rleftdotsright\nsigma_textext 4pi kappa^-1 k_1   Imleft(mathbfP cdot mathbfE_textinc^* right) 4pi k_1  Imleft(barmathbfP cdot mathbfE_textinc^* right)\nsigma_textabs 4pi kappa^-1 k_1 left Imleft(mathbfP cdot mathbfE^* right) - frac23kappa^-1k^3mathbfP^2 right 4pi k_1 left Imleft(barmathbfP cdot mathbfE^* right) - frac23k^3barmathbfP^2 right\nsigma_textsca kappa^-2k_1^4 iint_Omega leftsum_i left(mathbbI - mathbfhat notimesmathbfhat nright) mathbfP_i e^-ik_1 mathbfr_icdotmathbfhat nright^2 textdOmega k_1^4 iint_Omega leftsum_i left(mathbbI - mathbfhat notimesmathbfhat nright) barmathbfP_i e^-ik_1 mathbfr_icdotmathbfhat nright^2 textdOmega","category":"page"},{"location":"theory/#Particle-polarisability","page":"Coupled dipole theory","title":"Particle polarisability","text":"","category":"section"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"The static polarisability of a sphere of radius a in a medium is given by (ref. Jackson, Griffith) (note that the dielectric constant varepsilon is sometimes factored in the dipole moment instead),","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"mathbbalpha = kappa a^3 fracvarepsilon - varepsilon_pvarepsilon + 2 varepsilon_pmathbbI qquad mathbfP=mathbbalphamathbfE","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"This equation describes the response of a spherical particle to a static electric field. In nano-optics, the nanoparticles may be much smaller than the wavelength (and therefore are excited by an essentially constant field at any given time), but the time-variation of the fields implies that the induced dipole radiates. This requires a correction to the polarisability to satisfy energy conservation, namely an imaginary component accounting for radiative reaction. Meier and Wokaun proposed\\cite{} that larger nanoparticles may also benefit from a dynamic-depolarisation correction, which takes into account the dephasing of the internal field across finite nanoparticles and provides a more accurate description of their optical response.","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"For homogeneous nanospheres and spherical nanoshells, the Mie theory readily provides an exact polarisability, but in practice it is often sufficient to use an approximate (but closed-form) formula. For other geometries, no analytical solution is known. The static polarisability of ellipsoids may be derived analytically, and long-wavelength corrections have been proposed following the strategy of Meier and Wokaun. The accuracy is however rather poor in practice\\cite{moroz,luke}, and we use instead the semi-empirical formula proposed by Kuwata et al. based on fits of full-wave simulations\\cite{kuwata}.","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"alpha_i =  fracV4pifrac1L_i + fracvarepsilonvarepsilon_p-varepsilon +\n              A varepsilon x^2 +  B varepsilon^2 x^4 - ifrac4pi^2varepsilon^323  V lambda^3","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"with V the volume of the particle, and x = frac2pi a_ilambda the size parameter along the semi-axis a_i (a, b, or c in the case of spheroids).","category":"page"},{"location":"theory/#Dye-polarisability","page":"Coupled dipole theory","title":"Dye polarisability","text":"","category":"section"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"In our derivation of the CD equations we have taken a fully macroscopic viewpoint. In the case of molecular dipoles, the embedded dipoles (external inclusions), however, are still microscopic entities responding to the microscopic (local) field.","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"At a microscopic level, a dipole reacts to the applied field with an intrinsic polarisability alpha^mu. The applied field is enhanced by a local-field correction arising from the polarisation of the embedding medium, and we may define an effective polarisability for the dipole responding to a macroscopic field,","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":" p = L alpha^mu mathbfE","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"where L = dfracvarepsilon +23. In turn, such a dipole moment produces a field which is enhanced by the same local field factor, from a reciprocity argument. For our purposes, the effective macroscopic polarisability is therefore defined as","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"alpha = L^2 alpha^mu","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"where alpha^mu may have been obtained from first-principle calculations (e.g. DFT). With this link, the dipole moments all respond to macroscopic fields, and the coupling between dipoles follows the same equations as above, with macroscopic fields propagating in the ambient medium. We note that if the molecular response is derived from an experimental UV-vis absorption measurement, these considerations are not important: we can directly link the extinction (or absorption) cross-section to a macroscopic polarisability. This strategy is further discussed in the Appendix.","category":"page"},{"location":"theory/#Rotations-and-orientation-averaging","page":"Coupled dipole theory","title":"Rotations and orientation averaging","text":"","category":"section"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"The simulations are set up with respect to a fixed frame of reference (\"lab frame\"\"). The particle positions and orientations, as well as the incident field, are all specified in this common frame.","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"Rotation matrices are defined via Euler angles. Such matrices are used to specify particle orientations by rotation of their polarisability tensor.","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"Similarly, the incident wavevector and electric field are rotated to an arbitrary direction of incidence.  ","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"For the simulation of optical activity, or of disordered systems, we are often required to perform an average over the directions of incident light (incidence and polarisation). A given incident field is characterised by a wave-vector mathbfk and an electric vector mathbfE_textinc describing the light polarisation, and both of these vectors can be rotated using a rotation matrix R. The spectra are averaged over two orthogonal polarisations, with incident wave-vectors that span the full range of varphiin02pi thetain0pi. This averaging is performed by numerical integration,","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"leftsigmaright_Omega=frac1 4pi int_0^2piint_0^pi sigma(varphipsi) sin theta dtheta dvarphi","category":"page"},{"location":"theory/","page":"Coupled dipole theory","title":"Coupled dipole theory","text":"using a spherical cubature scheme (Gauss-Legendre, Lebedev, etc.).","category":"page"},{"location":"clusters/#Cluster-geometries","page":"Cluster geometries","title":"Cluster geometries","text":"","category":"section"},{"location":"clusters/","page":"Cluster geometries","title":"Cluster geometries","text":"Cluster","category":"page"},{"location":"clusters/#CoupledDipole.Cluster","page":"Cluster geometries","title":"CoupledDipole.Cluster","text":"Cluster(positions, angles, sizes, material)\n\nParticle cluster specification.\n\n\n\n\n\n","category":"type"},{"location":"clusters/","page":"Cluster geometries","title":"Cluster geometries","text":"cluster_single","category":"page"},{"location":"clusters/#CoupledDipole.cluster_single","page":"Cluster geometries","title":"CoupledDipole.cluster_single","text":"cluster_single(a::T, b::T, c::T, α::T = 0.0, β::T = 0.0, γ::T = 0.0) where T <: Real\n\nParticle cluster consisting of a single particle at the origin\n\na,b,c: semi-axis along x,y,z\nα,β,γ: Euler angles\nmaterial: String referencing the material of the particle\ntype: String, \"point\" dipole or \"particle\"\n\nExamples\n\ncluster_single(1.0,2.0,3.0)\n\n\n\n\n\n","category":"function"},{"location":"clusters/","page":"Cluster geometries","title":"Cluster geometries","text":"cluster_dimer","category":"page"},{"location":"clusters/#CoupledDipole.cluster_dimer","page":"Cluster geometries","title":"CoupledDipole.cluster_dimer","text":"cluster_dimer(d::T, a::T, b::T, c::T, ϕ::T = 0.0, α_1::T = 0.0, α_2::T = 0.0) where T <: Real\n\nParticle cluster consisting of 2 identical particles separated along y\n\na,b,c: semi-axes along x,y,z\nϕ: dihedral angle between both particles seen along the y-axis\nα_1,α_2: angle of each particle with the y axis\nmaterial: String referencing the material of every particle\ntype: String, \"point\" dipole or \"particle\"\n\nExamples\n\ncluster_dimer(80, 10, 10, 20)\n\n\n\n\n\n","category":"function"},{"location":"clusters/","page":"Cluster geometries","title":"Cluster geometries","text":"(Image: helix cluster)","category":"page"},{"location":"clusters/","page":"Cluster geometries","title":"Cluster geometries","text":"cluster_helix","category":"page"},{"location":"clusters/#CoupledDipole.cluster_helix","page":"Cluster geometries","title":"CoupledDipole.cluster_helix","text":"cluster_helix(N, a, b, c, R, Λ, δ = π/4, δ_0 = 0, handedness=\"left\",\n    material = \"Au\", type=\"particle\")\n\nHelical cluster of N identical particles with axis along z\n\nN: number of particles\na,b,c: semi-axes along x,y,z\nR: helix radius\nΛ: helix pitch\nδ: angle between subsequent particles\nδ: starting angle\nhandedness: \"left\" or \"right\"\nmaterial: String referencing the material of every particle\ntype: String, \"point\" dipole or \"particle\"\n\nExamples\n\ncluster_helix(4, 20, 20, 30, 50, 300)\n\n\n\n\n\n","category":"function"},{"location":"clusters/","page":"Cluster geometries","title":"Cluster geometries","text":"cluster_line","category":"page"},{"location":"clusters/#CoupledDipole.cluster_line","page":"Cluster geometries","title":"CoupledDipole.cluster_line","text":"cluster_line(N, Λ, a, b, c, φ, θ, ψ, material = \"Au\", type=\"particle\")\n\nLine of N identical particles in the x direction\n\nN: number of particles (approximate if not exact square)\na,b,c: semi-axes along x,y,z\nΛ: array pitch\nφ, θ, ψ: particle Euler angles\nmaterial: String referencing the material of every particle\ntype: String, \"point\" dipole or \"particle\"\n\nExamples\n\ncluster_line(3, 500, 20, 20, 30, 0, 0, 0)\n\n\n\n\n\n","category":"function"},{"location":"clusters/","page":"Cluster geometries","title":"Cluster geometries","text":"cluster_array","category":"page"},{"location":"clusters/#CoupledDipole.cluster_array","page":"Cluster geometries","title":"CoupledDipole.cluster_array","text":"cluster_array(N, Λ, a, b, c, φ, θ, ψ, material = \"Au\", type=\"particle\")\n\nSquare array of N identical particles in the xy plane\n\nN: number of particles (approximate if not exact square)\na,b,c: semi-axes along x,y,z\nΛ: array pitch\nφ, θ, ψ: particle Euler angles\nmaterial: String referencing the material of every particle\ntype: String, \"point\" dipole or \"particle\"\n\nExamples\n\ncluster_array(4, 500, 20, 20, 30, 0, 0, 0)\n\n\n\n\n\n","category":"function"},{"location":"high_level/#High-level-Interface","page":"High-level Interface","title":"High-level Interface","text":"","category":"section"},{"location":"high_level/","page":"High-level Interface","title":"High-level Interface","text":"spectrum_dispersion","category":"page"},{"location":"high_level/#CoupledDipole.spectrum_dispersion","page":"High-level Interface","title":"CoupledDipole.spectrum_dispersion","text":" spectrum_dispersion(cl::Cluster, mat::Material,\n                     Incidence, N_sca::Int=36)\n\nSimulating far-field cross-sections for multiple wavelengths and directions of incidence\n\ncl: cluster of particles\nmat: dielectric functions\nIncidence: N_inc vector of 3-Svectors of incidence Euler angles\nN_sca: number of scattering angles for spherical cubature estimate of σ_sca\n\n\n\n\n\n","category":"function"},{"location":"high_level/","page":"High-level Interface","title":"High-level Interface","text":"spectrum_oa","category":"page"},{"location":"high_level/#CoupledDipole.spectrum_oa","page":"High-level Interface","title":"CoupledDipole.spectrum_oa","text":" spectrum_oa(cl::Cluster, mat::Material,\n            Cubature = \"gl\", N_inc::Int = 36, N_sca::Int=36)\n\nOrientation-averaged far-field cross-sections for multiple wavelengths\n\ncl: cluster of particles\nmat: dielectric functions\nCubature: spherical cubature method\nN_inc: number of incident angles for spherical cubature\nN_sca: number of scattering angles for spherical cubature estimate of σ_sca\n\n\n\n\n\n","category":"function"},{"location":"background/#Background-and-Motivation","page":"Background and Motivation","title":"Background and Motivation","text":"","category":"section"},{"location":"background/","page":"Background and Motivation","title":"Background and Motivation","text":"The coupled dipole method is a convenient approximation to describe multiple scattering in relatively sparse clusters of particles (or molecules) smaller than the wavelength.","category":"page"},{"location":"background/","page":"Background and Motivation","title":"Background and Motivation","text":"The central approximation is that the response of a given particle to the incident field is described in the electric dipole approximation as","category":"page"},{"location":"background/","page":"Background and Motivation","title":"Background and Motivation","text":"mathbfP = mathbbalpha mathbfE","category":"page"},{"location":"background/","page":"Background and Motivation","title":"Background and Motivation","text":"where mathbfE is the net electric field at that location. More details on the theory are summarised here.","category":"page"},{"location":"helix/#Helix-of-gold-nanorods","page":"Helix of gold nanorods","title":"Helix of gold nanorods","text":"","category":"section"},{"location":"helix/","page":"Helix of gold nanorods","title":"Helix of gold nanorods","text":"This example considers a short helix of gold nanorods, and simulates its orientation-averaged circular dichroism. Two helices are modelled, with opposite handedness, to verify that they produce mirror-image dichroism spectra.","category":"page"},{"location":"helix/","page":"Helix of gold nanorods","title":"Helix of gold nanorods","text":"using CoupledDipole\nusing DataFrames\nusing VegaLite\n\n## materials\nwavelengths = collect(400:2:1000.0)\nmedia = Dict([(\"Au\", epsilon_Au), (\"medium\", x -> 1.33)])\nmat = Material(wavelengths, media)\n\n## cluster geometry\ncl1 = cluster_helix(8, 20, 20, 40, 100, 400, π/2, 0)\ncl2 = cluster_helix(8, 20, 20, 40, 100, 400, π/2, 0, \"right\")\ncl0 = cluster_single(20, 20, 40)\n\n\noa0 = spectrum_oa(cl0, mat)\noa1 = spectrum_oa(cl1, mat)\noa2 = spectrum_oa(cl2, mat)\n\nd0 = oa_df(oa0, mat.wavelengths)\nd1 = oa_df(oa1, mat.wavelengths)\nd2 = oa_df(oa2, mat.wavelengths)\n\nd = [insertcols!(d1, :cluster => \"helix\", :hand => \"left\");\n      insertcols!(d2, :cluster => \"helix\", :hand => \"right\");\n      insertcols!(d0, :cluster => \"single\", :hand => \"_\")]\n\n\nd |> @vlplot(\n width= 120,\n height =  100,\n     mark = {:line},\n     row = \"type\", column=\"variable\",\n     resolve={scale={y=\"independent\"}},\n     encoding = {x = \"wavelength:q\", y = \"value:q\",\n      strokeDash = \"cluster:n\",  color = \"hand:n\"}\n )\n","category":"page"},{"location":"cross_sections/#Far-field-cross-sections","page":"Far field cross-sections","title":"Far field cross-sections","text":"","category":"section"},{"location":"cross_sections/#Extinction","page":"Far field cross-sections","title":"Extinction","text":"","category":"section"},{"location":"cross_sections/","page":"Far field cross-sections","title":"Far field cross-sections","text":"The extinction cross-section may be obtained from the optical theorem as the interference between incident and scattered fields,","category":"page"},{"location":"cross_sections/","page":"Far field cross-sections","title":"Far field cross-sections","text":"sigma_textext = 4pikappa^-1 k_1 Imleft(mathbfP cdot mathbfE_textinc^* right)","category":"page"},{"location":"cross_sections/","page":"Far field cross-sections","title":"Far field cross-sections","text":"extinction!","category":"page"},{"location":"cross_sections/#CoupledDipole.extinction!","page":"Far field cross-sections","title":"CoupledDipole.extinction!","text":"extinction(kn::Real, P::Array{Complex}, Ein::Array{Complex})\n\nExtinction cross-section for each incident angle\n\nkn: wavenumber in incident medium\nP:   3N_dip x N_inc matrix, polarisations for all incidences\nEin: 3N_dip x N_inc matrix, incident field for all incidences\n\n\n\n\n\n","category":"function"},{"location":"cross_sections/#Absorption","page":"Far field cross-sections","title":"Absorption","text":"","category":"section"},{"location":"cross_sections/","page":"Far field cross-sections","title":"Far field cross-sections","text":"The absorption cross-section is obtained by evaluating the work done by the total field, (but excluding self-reaction), on the dipoles:","category":"page"},{"location":"cross_sections/","page":"Far field cross-sections","title":"Far field cross-sections","text":"sigma_textabs =  4pi kappa^-1 k_1 leftImleft(mathbfP cdot mathbfE^* right) - frac 2 3 kappa^-1 k_1^3 mathbfP^2right","category":"page"},{"location":"cross_sections/","page":"Far field cross-sections","title":"Far field cross-sections","text":"absorption!","category":"page"},{"location":"cross_sections/#CoupledDipole.absorption!","page":"Far field cross-sections","title":"CoupledDipole.absorption!","text":"absorption(kn::Real, P::Array{Complex}, E::Array{Complex})\n\nAbsorption cross-section for each incident angle\n\nkn: wavenumber in incident medium\nP: 3N_dip x N_inc matrix, polarisations for all incidences\nE: 3N_dip x N_inc matrix, total field for all incidences\n\n\n\n\n\n","category":"function"},{"location":"cross_sections/#Scattering","page":"Far field cross-sections","title":"Scattering","text":"","category":"section"},{"location":"cross_sections/","page":"Far field cross-sections","title":"Far field cross-sections","text":"The scattering cross-section can be computed in two ways:","category":"page"},{"location":"cross_sections/","page":"Far field cross-sections","title":"Far field cross-sections","text":"as the difference between extinction and absorption\nby integrating the flux of the Poynting vector over all scattering directions in the far-field. ","category":"page"},{"location":"cross_sections/","page":"Far field cross-sections","title":"Far field cross-sections","text":"Comparing both results might be useful as a consistency check.","category":"page"},{"location":"cross_sections/","page":"Far field cross-sections","title":"Far field cross-sections","text":"sigma_textsca = kappa^-2 k_1^4 iint_Omega leftsum_i left(mathbbI - mathbfhat notimesmathbfhat nright) mathbfP_i mathrmexp(-ik_1 mathbfr_icdotmathbfhat n)right^2 textdOmega","category":"page"},{"location":"cross_sections/","page":"Far field cross-sections","title":"Far field cross-sections","text":"scattering!","category":"page"},{"location":"cross_sections/#CoupledDipole.scattering!","page":"Far field cross-sections","title":"CoupledDipole.scattering!","text":"scattering(positions::Vector{SVector{3}}, ScatteringVectors::Vector{SVector{3}}, weights::Vector{Real}, kn::Real, P::Array{Complex})\n\nScattering cross-section for each incident angle, obtained by numerical cubature over the full solid angle of scattering directions\n\npositions: vector of cluster particle positions\nScatteringProjectorz: N_inc-vector of far-field directions\nweights: N_inc-vector of cubature weights\nkn: wavenumber in incident medium\nP: 3N_dip x N_inc matrix, polarisations for all incidences\n\n\n\n\n\n","category":"function"},{"location":"","page":"Home","title":"Home","text":"CurrentModule = CoupledDipole","category":"page"},{"location":"#CoupledDipole","page":"Home","title":"CoupledDipole","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Documentation for CoupledDipole.","category":"page"},{"location":"","page":"Home","title":"Home","text":"","category":"page"},{"location":"","page":"Home","title":"Home","text":"# Modules = [CoupledDipole] # seems to duplicate everything","category":"page"}]
}
